# RAG CLI ассистент по внутренним документам

## Описание
Проект реализует консольного ассистента по внутренним документам маркетинга (FAQ, глоссарий, метрики, регламенты).  
Ассистент использует подход **RAG (Retrieval-Augmented Generation)** с TF-IDF для поиска релевантных фрагментов документов и генерации ответов.

---
## Настройка

### 1. Создайте `.env` (если еще не создан) на основе `.env.example`
`USE_LLM=0`

`MODEL_NAME=stub`

`TOP_K=3`

`NO_ANSWER_THRESHOLD=0.42`

`CHUNK_SIZE=150`

`CHUNK_OVERLAP=50`

### 2. Установите зависимости
`pip install -r requirements.txt`

## Запуск

### Индексация документов
`python src/index.py`

### Консольный режим ассистента
`python src/cli.py`

`Введите запрос:`

### Автоматический запуск тестовых вопросов и сравнение с эталонными ответами
`python src/eval.py`

### Индексация + запуск ассистента одной командой
`python src/index.py ; python src/cli.py `

## Переменные окружения

- **USE_LLM** – переключатель режима генерации:
  - `0` – экстрактивный режим: ассистент возвращает 2–3 наиболее релевантные цитаты из документов с краткой сводкой.
  - `1` – генеративный режим (RAG): финальный ответ формируется LLM строго на основе найденных фрагментов.

- **MODEL_NAME** – имя модели для генерации ответов (по умолчанию `stub` для тестового режима).

- **TOP_K** – количество возвращаемых наиболее релевантных фрагментов из индекса.

- **NO_ANSWER_THRESHOLD** – порог релевантности для выдачи ответа. Если лучший фрагмент ниже порога, ассистент возвращает «Нет ответа».

- **CHUNK_SIZE** – размер чанка (количество слов), на которое разбиваются документы для индексации.

- **CHUNK_OVERLAP** – перекрытие между чанками (в словах) для сохранения контекста между соседними фрагментами.

---

## Файлы проекта

- `src/index.py` – строит TF-IDF индекс документов.
- `src/cli.py` – консольный интерфейс для ввода запросов.
- `src/eval.py` – проверка качества ассистента на тестовом наборе вопросов (выдает метрику точности).
- `src/retriever.py` – реализация TF-IDF ретривера с косинусной близостью.
- `src/llm_stub.py` – заглушка LLM для генерации ответов.
- `src/utils.py` – утилиты для работы с текстом, разбиения на чанки, сохранения/загрузки индекса и цитат.
- `docs/` – директория с исходными документами (FAQ, glossary, metrics и т.д.).
- `tests/fixtures/questions.jsonl` – тестовый набор вопросов для проверки точности ассистента.
- `index.pkl` – готовый TF-IDF индекс документов, создается после запуска `index.py`.
